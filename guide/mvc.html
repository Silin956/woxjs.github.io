<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>设计理念 | WoX</title>
    <meta name="description" content="A dynamic loader MVC architecture based on Vue.js development which use web virtual service and web virtual request mode.">
    
    
    <link rel="preload" href="/assets/css/0.styles.9ede7954.css" as="style"><link rel="preload" href="/assets/js/app.bf16abc9.js" as="script"><link rel="preload" href="/assets/js/3.d6f7a4c8.js" as="script"><link rel="prefetch" href="/assets/js/10.ce8fbcca.js"><link rel="prefetch" href="/assets/js/11.8acb355b.js"><link rel="prefetch" href="/assets/js/12.4eca615b.js"><link rel="prefetch" href="/assets/js/13.ff73f045.js"><link rel="prefetch" href="/assets/js/14.e15a24a3.js"><link rel="prefetch" href="/assets/js/15.760e39af.js"><link rel="prefetch" href="/assets/js/2.5ed48305.js"><link rel="prefetch" href="/assets/js/4.c0e03a07.js"><link rel="prefetch" href="/assets/js/5.207e9a59.js"><link rel="prefetch" href="/assets/js/6.ff8ba342.js"><link rel="prefetch" href="/assets/js/7.9308bdd8.js"><link rel="prefetch" href="/assets/js/8.4cae5880.js"><link rel="prefetch" href="/assets/js/9.3e22567b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9ede7954.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">WoX</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">简介</a></div><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">指南</a></div><div class="nav-item"><a href="/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/cli/" class="nav-link">脚手架</a></div><div class="nav-item"><a href="/plugins/" class="nav-link">核心插件</a></div> <a href="https://github.com/woxjs/wox" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">简介</a></div><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">指南</a></div><div class="nav-item"><a href="/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/cli/" class="nav-link">脚手架</a></div><div class="nav-item"><a href="/plugins/" class="nav-link">核心插件</a></div> <a href="https://github.com/woxjs/wox" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/guide/" class="sidebar-link">渐进式开发指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/#兼容性" class="sidebar-link">兼容性</a></li><li class="sidebar-sub-header"><a href="/guide/#vue-devtools" class="sidebar-link">Vue Devtools</a></li><li class="sidebar-sub-header"><a href="/guide/#cli" class="sidebar-link">CLI</a></li><li class="sidebar-sub-header"><a href="/guide/#创建项目" class="sidebar-link">创建项目</a></li><li class="sidebar-sub-header"><a href="/guide/#目录结构" class="sidebar-link">目录结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/#主项目目录" class="sidebar-link">主项目目录</a></li><li class="sidebar-sub-header"><a href="/guide/#插件配置目录" class="sidebar-link">插件配置目录</a></li><li class="sidebar-sub-header"><a href="/guide/#本项目配置目录" class="sidebar-link">本项目配置目录</a></li></ul></li></ul></li><li><a href="/guide/mvc.html" class="active sidebar-link">设计理念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/mvc.html#解偶模式" class="sidebar-link">解偶模式</a></li><li class="sidebar-sub-header"><a href="/guide/mvc.html#mvc-模型" class="sidebar-link">MVC 模型</a></li><li class="sidebar-sub-header"><a href="/guide/mvc.html#对比vue-router" class="sidebar-link">对比Vue-router</a></li><li class="sidebar-sub-header"><a href="/guide/mvc.html#真正的动态路由化" class="sidebar-link">真正的动态路由化</a></li><li class="sidebar-sub-header"><a href="/guide/mvc.html#简介核心各层及代码演示" class="sidebar-link">简介核心各层及代码演示</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/mvc.html#controller" class="sidebar-link">Controller</a></li><li class="sidebar-sub-header"><a href="/guide/mvc.html#middleware" class="sidebar-link">Middleware</a></li><li class="sidebar-sub-header"><a href="/guide/mvc.html#service" class="sidebar-link">Service</a></li><li class="sidebar-sub-header"><a href="/guide/mvc.html#webview" class="sidebar-link">Webview</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide/mvc.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/guide/service.html" class="sidebar-link">Web Virtual Service</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/service.html#由来" class="sidebar-link">由来</a></li><li class="sidebar-sub-header"><a href="/guide/service.html#应用程序" class="sidebar-link">应用程序</a></li><li class="sidebar-sub-header"><a href="/guide/service.html#中间件" class="sidebar-link">中间件</a></li><li class="sidebar-sub-header"><a href="/guide/service.html#渲染模板" class="sidebar-link">渲染模板</a></li><li class="sidebar-sub-header"><a href="/guide/service.html#虚拟线程对象" class="sidebar-link">虚拟线程对象</a></li><li class="sidebar-sub-header"><a href="/guide/service.html#监听请求事件" class="sidebar-link">监听请求事件</a></li><li class="sidebar-sub-header"><a href="/guide/service.html#虚拟请求" class="sidebar-link">虚拟请求</a></li><li class="sidebar-sub-header"><a href="/guide/service.html#插件作用域" class="sidebar-link">插件作用域</a></li></ul></li><li><a href="/guide/config.html" class="sidebar-link">配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/config.html#项目配置" class="sidebar-link">项目配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/config.html#系统配置" class="sidebar-link">系统配置</a></li><li class="sidebar-sub-header"><a href="/guide/config.html#自定义配置" class="sidebar-link">自定义配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide/config.html#插件列表" class="sidebar-link">插件列表</a></li><li class="sidebar-sub-header"><a href="/guide/config.html#插件配置" class="sidebar-link">插件配置</a></li></ul></li><li><a href="/guide/runtime.html" class="sidebar-link">运行原理剖析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/runtime.html#webpack聚合文件-wox-js" class="sidebar-link">webpack聚合文件.wox.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/runtime.html#component-array" class="sidebar-link">component: Array</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#directive-array" class="sidebar-link">directive: Array</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#filter-array" class="sidebar-link">filter: Array</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#mixin-array" class="sidebar-link">mixin: Array</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#bootstrap-array" class="sidebar-link">bootstrap: Array</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#view-vue" class="sidebar-link">view: Vue</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#plugin-configs-object" class="sidebar-link">plugin_configs: object</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#custom-configs-array" class="sidebar-link">custom_configs: Array</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#controller-array" class="sidebar-link">controller: Array</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#decorate-array" class="sidebar-link">decorate: Array</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#bootstrap-render" class="sidebar-link">Bootstrap render</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#service-decorate-inject" class="sidebar-link">Service Decorate Inject</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#analysis-all-decorates" class="sidebar-link">Analysis All Decorates</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#inject-decorates-into-inteface" class="sidebar-link">Inject Decorates Into Inteface</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#controller-parse-and-render" class="sidebar-link">Controller parse and render</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#compose-routers" class="sidebar-link">Compose Routers</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#load-vue-and-mount-it" class="sidebar-link">Load vue and mount it</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#create-server" class="sidebar-link">Create Server</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#生命周期" class="sidebar-link">生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/runtime.html#plugindidinstalled" class="sidebar-link">PluginDidInstalled</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#decoratedidinstalled" class="sidebar-link">DecorateDidInstalled</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#routerwillinstall" class="sidebar-link">RouterWillInstall</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#routerdidinstalled" class="sidebar-link">RouterDidInstalled</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#setup" class="sidebar-link">setup</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#serverwillcreate" class="sidebar-link">ServerWillCreate</a></li><li class="sidebar-sub-header"><a href="/guide/runtime.html#serverdidcreated" class="sidebar-link">ServerDidCreated</a></li></ul></li></ul></li><li><a href="/guide/request.html" class="sidebar-link">虚拟请求流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/request.html#定义虚拟请求" class="sidebar-link">定义虚拟请求</a></li><li class="sidebar-sub-header"><a href="/guide/request.html#controller中发送虚拟请求" class="sidebar-link">Controller中发送虚拟请求</a></li><li class="sidebar-sub-header"><a href="/guide/request.html#vue文件中发送虚拟请求" class="sidebar-link">Vue文件中发送虚拟请求</a></li><li class="sidebar-sub-header"><a href="/guide/request.html#虚拟请求中的错误处理" class="sidebar-link">虚拟请求中的错误处理</a></li></ul></li><li><a href="/guide/controller.html" class="sidebar-link">Controller JSX</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/controller.html#直接输出组件到浏览器" class="sidebar-link">直接输出组件到浏览器</a></li><li class="sidebar-sub-header"><a href="/guide/controller.html#函数分离" class="sidebar-link">函数分离</a></li><li class="sidebar-sub-header"><a href="/guide/controller.html#通过虚拟请求获取组件" class="sidebar-link">通过虚拟请求获取组件</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="设计理念"><a href="#设计理念" aria-hidden="true" class="header-anchor">#</a> 设计理念</h1> <p>Wox.js的设计理念与解决方案非常明确，就是建立一套灵活的路由服务体系，让业务开发更加解偶。</p> <h2 id="解偶模式"><a href="#解偶模式" aria-hidden="true" class="header-anchor">#</a> 解偶模式</h2> <p>类似于微服务概念，它通过虚拟请求提供组件服务之间的数据交互，并且它具有独立而完整的路由以及内部私有数据响应。它可以是一个完整项目，也可以是一个空壳项目（通过组件提供各部分所需要的路由及数据），便于快速聚合组件形成业务项目。</p> <p><img src="/assets/img/wox-server-container.f9d59ddb.png" alt="wox server container"></p> <p>每个<code>wox service</code>相当于一个插件，而<code>wox server</code>相当于一个大的启动容器，容器可以没有任何业务逻辑，仅仅做<code>config</code>配置，达到功能高度解偶到各组件中效果。</p> <h2 id="mvc-模型"><a href="#mvc-模型" aria-hidden="true" class="header-anchor">#</a> MVC 模型</h2> <p><a href="https://baike.baidu.com/item/MVC%E6%A1%86%E6%9E%B6/9241230?fr=aladdin&fromid=85990&fromtitle=MVC" target="_blank" rel="noopener noreferrer">MVC<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 开始是存在于桌面程序中的，M是指业务模型，V是指用户界面，C则是控制器，使用MVC的目的是将M和V的实现代码分离，从而使同一个程序可以使用不同的表现形式。比如一批统计数据可以分别用柱状图、饼图来表示。C存在的目的则是确保M和V的同步，一旦M改变，V应该同步更新。</p> <p>Wox.js 采用mvc模型来管理整个请求模型，同时结合Vue.js的 <a href="https://baike.baidu.com/item/MVVM" target="_blank" rel="noopener noreferrer">MVVM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 模型，使得数据驱动变得非常简便。我们采用 <a href="https://github.com/koajs/koa" target="_blank" rel="noopener noreferrer">KOA<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 模型来构建前端的web服务体系，解决传统前端路由的通病。</p> <h2 id="对比vue-router"><a href="#对比vue-router" aria-hidden="true" class="header-anchor">#</a> 对比Vue-router</h2> <p><a href="https://router.vuejs.org/" target="_blank" rel="noopener noreferrer">Vue-router<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是vue的标准路由，但它是一种静态路由，而非动态路由。</p> <p>所谓静态路由，就是一个路由对应一个component组件，只要路由确定页面一定是确定的。它的优势在于能够快速确定渲染页面，性能很高。但是它的优势也成为了它的劣势。往往我们在后台系统界面中，可能会出现一个路由并非对应一个component组件页面，而是需要一些变量来决定使用哪个页面。Vue-router 无法做到。</p> <p>在这里我们强补下路由概念：</p> <ul><li>静态路由：<code>Router = Component</code> 路由与页面一一对应，无论任意时间来观察页面，显示的内容都是一致的，表现为感官上的一致；实际运行时表现为路由与组件的一一对应。</li> <li>动态路由：<code>Router = ComponentRender()</code> 路由根据时间或者环境的变化，会产生不一致的渲染效果，感官上表现为不同的页面；实际上路由应该对应的并非组件，而是一个选取组件的回调函数，比如<code>react-routerV4</code>中的render用法。</li></ul> <p>为了能够在PC端后台系统上可以完美解决各种路由规则以及拦截（中间件）的问题，我们摒弃了<code>vue-router</code>，因为在<code>Vue-router</code>上，我们需要写各种<code>hooks</code>才能完成我们需要的工作，大大增加了我们的开发成本。</p> <h2 id="真正的动态路由化"><a href="#真正的动态路由化" aria-hidden="true" class="header-anchor">#</a> 真正的动态路由化</h2> <p>基于restful设计理念，我们将前端路由动态化，我们通过一个路由对应一个回调函数的模式让路由的选择趋于动态化。在路由改变的时候，我们都会自动选择需要渲染的页面。这就是wox.js的优势。我们选择koa做为原型是因为它是业界（nodejs）比较成熟的企业应用级MVC架构。它的成熟的理念已经被市场检验认证过。</p> <p>同时，基于自身带有<code>Virtual Service</code>的理念存在，也可以自获取数据，而脱离服务端的数据返回。类似 <code>this.$post('/api', {}).then()</code> 的调用模式，以及我们在controller层对此路由的定义<code>@Http.Post('/api')</code>。</p> <h2 id="简介核心各层及代码演示"><a href="#简介核心各层及代码演示" aria-hidden="true" class="header-anchor">#</a> 简介核心各层及代码演示</h2> <p>下面，将讲解如何一步一步创建MVC中的各层。</p> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>我们建议使用工具创建我们的文件，在创建的文件基础上可自行修改。</p></div> <h3 id="controller"><a href="#controller" aria-hidden="true" class="header-anchor">#</a> Controller</h3> <p>controller层文件都是基于class的写法，同时使用注解形式标记路由规则。请看：</p> <div class="language-javascript line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><br></div><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> 
  Http<span class="token punctuation">,</span>
  Controller<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wox/wox'</span><span class="token punctuation">;</span>

@Controller
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">DemoController</span> <span class="token punctuation">{</span>
  @Http<span class="token punctuation">.</span>Get
  <span class="token keyword">async</span> <span class="token function">Home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>webview<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>它主要控制路由的行为，渲染页面和返回接口数据都是通过它来完成。每个函数，可以通过直接<code>return data</code>来返回数据，也可以通过<code>ctx.body</code>来返回。建议使用<code>return</code>返回，达到controller内部函数复用的目的。</p> <h4 id="注解"><a href="#注解" aria-hidden="true" class="header-anchor">#</a> 注解</h4> <p>所谓<a href="http://web.jobbole.com/88572/" target="_blank" rel="noopener noreferrer">注解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，一般可以理解为注释，在ES中的叫法为<code>装饰器</code>，在js的世界中，它具有执行意义。wox.js中注解有这么几个:</p> <ul><li><code>@Controller(prefix: string)</code> 标记该函数是一个controller函数，并且设置prefix前缀</li> <li><code>@Middleware(...middlewares: Middleware)</code> 标记这个前端所使用的中间件。</li> <li><code>@Http.verb(prefix: string)</code> 标记这个controller下有一个请求方式，同时设置path规则。</li> <li><code>@Param(name: string, middleware: Middleware)</code> 标记这个controller的一个param拦截器。</li> <li><code>@Interface.Service(name: string, service: Service)</code> 标记这个请求所使用到的服务对象。</li></ul> <h4 id="restful-api-virtual-request"><a href="#restful-api-virtual-request" aria-hidden="true" class="header-anchor">#</a> Restful api [Virtual Request]</h4> <p>内部可以通过fetch方法来调用自己的逻辑。主要有以下几个方法：</p> <ul><li><code>get(url)</code></li> <li><code>post(url, data)</code></li> <li><code>put(url, data)</code></li> <li><code>delete(url)</code></li></ul> <p>它们都返回一个<code>Promise</code>对象，表明结果数据。</p> <div class="language-javascript line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> 
  Http<span class="token punctuation">,</span>
  Controller<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@wox/wox'</span><span class="token punctuation">;</span>

@Controller
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">DemoController</span> <span class="token punctuation">{</span>
  @Http<span class="token punctuation">.</span>Get
  <span class="token keyword">async</span> <span class="token function">welcome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      action<span class="token punctuation">:</span> <span class="token string">'jump'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>IndexWebview<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      text<span class="token punctuation">:</span> res <span class="token comment">// abc jump</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @Http<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">'/test'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'abc '</span> <span class="token operator">+</span> body<span class="token punctuation">.</span>action<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="middleware"><a href="#middleware" aria-hidden="true" class="header-anchor">#</a> Middleware</h3> <p>中间件，用来拦截请求并且自定义处理。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>abc <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这跟我们的koa中间件写法一致。但是我们还提供了一种写法：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> app <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>abc <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>由于Wox.js是基于Koa模型建立，那么部分非涉及到环境变量的Koa中间件都可以直接在前端使用。如果善用中间件模型，那么将使代码非常逻辑化和简单化。本中间件模型也支持<code>.param(value, ctx, next)</code>模式，具体参考Koa的<code>param</code>使用方式。</p></div> <h3 id="service"><a href="#service" aria-hidden="true" class="header-anchor">#</a> Service</h3> <p>用来处理具体业务逻辑。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// demo.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">DemoService</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>abc <span class="token operator">+</span> <span class="token string">'def'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在controller上可以这样使用</p> <div class="language-javascript line-numbers-mode"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br></div><pre class="language-javascript"><code>@Interface<span class="token punctuation">.</span><span class="token function">Service</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> DemoService<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token function">controller</span><span class="token punctuation">(</span><span class="token punctuation">{</span> Service <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token keyword">await</span> Service<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="webview"><a href="#webview" aria-hidden="true" class="header-anchor">#</a> Webview</h3> <p>即一个页面组件，写法就是vue的写法。但是通过<code>ctx.render</code>进行调用。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> indexPage <span class="token keyword">from</span> <span class="token string">'#/webview/index.vue'</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
<span class="token keyword">async</span> <span class="token function">controller</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>indexPage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>我们通过<code>Controller</code> <code>Middleware</code> <code>Service</code> 以及 <code>Webview</code> 将项目整体串联在一起，达到可高度复用的目的。之后介绍的插件模式，将详细讲解如何高度复用，以及高度继承。</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/woxjs/wox/edit/master/docs/guide/mvc.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/guide/" class="prev router-link-active">
          渐进式开发指南
        </a></span> <span class="next"><a href="/guide/service.html">
          Web Virtual Service
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.bf16abc9.js" defer></script><script src="/assets/js/3.d6f7a4c8.js" defer></script>
  </body>
</html>
